import{u as pe,g as ye,r as l,j as e,w as F,D as je,E as L,F as J,y as K,o as Z,n as k,t as V,p as Ne,q as ve,s as Se,v as we,G as Ae,H as _e,B as Ce}from"./index--phLt8yX.js";import{g as Oe,u as Ie}from"./BookmarkService-kVY_FjDV.js";import"./vendor-BEN4boU2.js";function Pe(){const y=pe(),{user:_}=ye(),[u,j]=l.useState([]),[W,C]=l.useState(!0),[h,X]=l.useState(""),[O,N]=l.useState(null),[I,x]=l.useState(""),[E,B]=l.useState(!1),[M,Y]=l.useState(new Set),[Q,P]=l.useState(new Set),[m,b]=l.useState(new Set),[G,ee]=l.useState(!0),[v,S]=l.useState(2.5),[f,$]=l.useState(""),[w,o]=l.useState(!1),[d,p]=l.useState(null),[R,c]=l.useState(null),se=l.useRef(null);l.useEffect(()=>{if(!_){y("/auth/login");return}T()},[_,y]),l.useEffect(()=>()=>{d&&(d.pause(),o(!1),p(null),c(null))},[d]),l.useEffect(()=>{if(u.length>0){const s=u.find(t=>t.audio_urls);if(s){const t=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;let a;if(Array.isArray(t)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];a=t.map((n,g)=>r[g]||`qari_${g+1}`)}else a=Object.keys(t);a.length>0&&!f&&$(a[0])}}},[u]);const ae=()=>{S(s=>Math.min(s+.5,6))},te=()=>{S(s=>Math.max(s-.5,1.5))},re=()=>{S(2.5)},ne=()=>({fontSize:`${v}rem`,lineHeight:"2",textShadow:"0 1px 1px rgba(0,0,0,0.05)"}),le=(s,t)=>{d&&(d.pause(),o(!1),c(null));const a=new Audio(s);se.current=a,a.play().then(()=>{o(!0),p(a),c(t),a.onended=()=>{o(!1),p(null),c(null)}}).catch(r=>{console.error("Error playing audio:",r),o(!1),c(null)})},H=()=>{d&&(d.pause(),o(!1),p(null),c(null))},ie=s=>{$(s),w&&H()},q=s=>{if(!(s!=null&&s.audio_urls))return[];const t=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;if(Array.isArray(t)){const a=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];return t.map((r,n)=>a[n]||`qari_${n+1}`)}else return Object.keys(t)},de=s=>{if(!(s!=null&&s.audio_urls))return null;const t=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;if(Array.isArray(t)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"].indexOf(f);return r!==-1?t[r]:t[0]}else return t[f]||Object.values(t)[0]},oe=s=>({"01":"Abdullah Al-Juhany","02":"Abdul Muhsin Al-Qasim","03":"Abdurrahman As-Sudais","04":"Ibrahim Al-Dossari","05":"Mishary Rashid Alafasy","06":"Maher Al Mueaqly","07":"Ahmed ibn Ali al-Ajamy","08":"Hani Ar-Rifai","09":"Mahmoud Khalil Al-Husary",10:"Mohamed Siddiq El-Minshawi",husary:"Mahmoud Khalil Al-Husary",sudais:"Abdurrahman As-Sudais",alafasy:"Mishary Rashid Alafasy",minshawi:"Mohamed Siddiq El-Minshawi",abdulbasit:"Abdul Basit Abdul Samad",maher:"Maher Al Mueaqly",ghamdi:"Saad Al Ghamdi",shuraim:"Saud Ash-Shuraim",ajmy:"Ahmed ibn Ali al-Ajamy",walk:"Hani Ar-Rifai"})[s]||`Qari ${s}`,T=async()=>{C(!0);try{const s=await Oe(!1);if(Array.isArray(s)){if(j(s),G&&s.length>0){const t=[...new Set(s.map(r=>r.surah_number))];b(new Set(t));const a=s.map(r=>r.id);P(new Set(a)),ee(!1)}}else console.error("Invalid bookmarks data received:",s),j([])}catch(s){console.error("Error loading bookmarks:",s),j([])}finally{C(!1)}},ce=s=>{var t;N(s.id),x(((t=s.pivot)==null?void 0:t.notes)||"")},ue=async s=>{B(!0);try{await Ie(s,I),await T(),N(null),x("")}catch(t){console.error("Error saving notes:",t)}finally{B(!1)}},he=()=>{N(null),x("")},me=s=>{Y(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},ge=s=>{P(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},xe=s=>{b(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},be=()=>{b(new Set)},fe=()=>{const s=i.map(t=>t.surah_number);b(new Set(s))},i=(()=>{if(!Array.isArray(u))return[];const s=u.filter(a=>{var n,g,z,U,D;if(!h)return!0;const r=h.toLowerCase();return((n=a.text_indonesian)==null?void 0:n.toLowerCase().includes(r))||((z=(g=a.surah)==null?void 0:g.name_indonesian)==null?void 0:z.toLowerCase().includes(r))||((U=a.ayah_number)==null?void 0:U.toString().includes(r))||((D=a.surah_number)==null?void 0:D.toString().includes(r))}),t={};return s.forEach(a=>{const r=a.surah_number;t[r]||(t[r]={surah:a.surah,surah_number:r,ayahs:[]}),t[r].ayahs.push(a)}),Object.values(t).sort((a,r)=>a.surah_number-r.surah_number).map(a=>({...a,ayahs:a.ayahs.sort((r,n)=>r.ayah_number-n.ayah_number)}))})(),A=i.filter(s=>!m.has(s.surah_number));return W?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 mb-8 border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>y(-1),className:"p-2 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 transition-all duration-200 border border-green-200",children:e.jsx(F,{className:"text-xl"})}),e.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"Bookmark Ayat"})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400"}),e.jsx("input",{type:"text",placeholder:"Cari ayat atau surah...",value:h,onChange:s=>X(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-green-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:i.length>0&&e.jsxs("div",{className:"text-sm text-green-600",children:[A.length," dari ",i.length," surah ditampilkan"]})}),i.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50/50 rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800",children:"Kontrol Tampilan Surah:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:be,className:"flex items-center gap-1 px-3 py-1 text-xs bg-green-100 border border-green-300 text-green-800 rounded hover:bg-green-200 transition-colors",children:[e.jsx(L,{}),"Tampilkan Semua"]}),e.jsxs("button",{onClick:fe,className:"flex items-center gap-1 px-3 py-1 text-xs bg-gray-100 border border-gray-300 text-gray-800 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(J,{}),"Sembunyikan Semua"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",children:i.map(s=>{var t,a,r;return e.jsxs("button",{onClick:()=>xe(s.surah_number),className:`flex items-center gap-2 px-3 py-2 text-xs rounded-lg border transition-all duration-200 ${m.has(s.surah_number)?"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200":"bg-green-100 border-green-300 text-green-800 hover:bg-green-200"}`,title:`${((t=s.surah)==null?void 0:t.name_indonesian)||`Surah ${s.surah_number}`} (${s.ayahs.length} ayat)`,children:[m.has(s.surah_number)?e.jsx(J,{className:"flex-shrink-0"}):e.jsx(L,{className:"flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.surah_number,". ",((r=(a=s.surah)==null?void 0:a.name_indonesian)==null?void 0:r.substring(0,8))||`Surah ${s.surah_number}`]}),e.jsxs("span",{className:"text-xs opacity-75",children:["(",s.ayahs.length,")"]})]},s.surah_number)})})]})]}),A.length===0?e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-12 border border-green-100 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(K,{className:"text-6xl text-green-300 mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold text-green-700 mb-2",children:h?"Tidak ada hasil yang ditemukan":m.size===i.length&&i.length>0?"Semua surah disembunyikan":"Belum ada bookmark"}),e.jsx("p",{className:"text-green-600",children:h?"Coba kata kunci yang berbeda":m.size===i.length&&i.length>0?"Gunakan kontrol surah untuk menampilkan bookmark":"Simpan ayat dengan menekan tombol bookmark"})]}):e.jsx("div",{className:"space-y-6",children:A.map(s=>{var t;return e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-green-100",children:[e.jsx("div",{className:"p-6 border-b border-green-100 cursor-pointer hover:bg-green-50/50 transition-colors rounded-t-3xl",onClick:()=>me(s.surah_number),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-green-800",children:((t=s.surah)==null?void 0:t.name_indonesian)||`Surah ${s.surah_number}`}),e.jsxs("span",{className:"text-green-600 font-medium",children:["(",s.ayahs.length," ayat)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:M.has(s.surah_number)?e.jsx(Z,{className:"text-xl text-green-600"}):e.jsx(k,{className:"text-xl text-green-600"})})]})}),!M.has(s.surah_number)&&e.jsx("div",{className:"divide-y divide-green-100",children:s.ayahs.map(a=>{var r;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 cursor-pointer p-2 rounded-lg hover:bg-green-50/50 transition-colors",onClick:()=>ge(a.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-800",children:["Ayat ",a.ayah_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"text-green-500",title:"Bookmark"}),a.is_favorite&&e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full border border-red-200",children:"Favorit"}),w&&R===a.id&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full border border-blue-200 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),"Playing"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:Q.has(a.id)?e.jsx(Z,{className:"text-lg text-green-600"}):e.jsx(k,{className:"text-lg text-green-600"})})]}),!Q.has(a.id)&&e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"bg-green-50/70 rounded-2xl p-6 mb-6 text-center relative",children:[e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[e.jsx("button",{onClick:te,disabled:v<=1.5,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perkecil teks Arab",children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors text-xs font-medium",title:"Reset ukuran teks Arab",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:ae,disabled:v>=6,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perbesar teks Arab",children:e.jsx(Se,{className:"w-4 h-4"})})]}),a.audio_urls&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[q(a).length>1&&e.jsx("select",{value:f,onChange:n=>ie(n.target.value),className:"p-1.5 text-xs rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500",title:"Pilih Qari",children:q(a).map(n=>e.jsx("option",{value:n,children:oe(n)},n))}),w&&R===a.id?e.jsx("button",{onClick:H,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors",title:"Pause Audio",children:e.jsx(we,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>{const n=de(a);n&&le(n,a.id)},className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors",title:"Play Audio",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"font-arabic text-green-800 leading-loose pt-8",style:ne(),dir:"rtl",children:a.text_arabic})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-green-700 leading-relaxed",children:a.text_indonesian})}),a.text_latin&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-green-600 italic text-sm",children:a.text_latin})}),e.jsxs("div",{className:"mt-6 p-4 bg-green-50 rounded-2xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Catatan:"}),O!==a.id&&e.jsx("button",{onClick:()=>ce(a),className:"p-1 rounded-md bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 transition-all duration-200 border border-green-200",title:"Edit catatan",children:e.jsx(Ae,{className:"text-lg"})})]}),O===a.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:I,onChange:n=>x(n.target.value),placeholder:"Tambahkan catatan untuk ayat ini...",className:"w-full p-2 text-sm border border-green-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:"3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ue(a.id),disabled:E,className:"flex items-center gap-1 px-3 py-1 bg-green-100 border border-green-300 text-green-800 text-sm rounded hover:bg-green-200 disabled:opacity-50 transition-colors",children:[e.jsx(_e,{}),E?"Menyimpan...":"Simpan"]}),e.jsxs("button",{onClick:he,className:"flex items-center gap-1 px-3 py-1 bg-gray-100 border border-gray-300 text-gray-800 text-sm rounded hover:bg-gray-200 transition-colors",children:[e.jsx(Ce,{}),"Batal"]})]})]}):e.jsx("p",{className:"text-green-700 text-sm",children:((r=a.pivot)==null?void 0:r.notes)||"Klik tombol edit untuk menambahkan catatan..."})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-green-200",children:e.jsxs("a",{href:`/surah/${a.surah_number}`,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-50 text-green-800 hover:bg-green-100 font-medium transition-all duration-200 border border-green-200",children:["Baca Surah",e.jsx(F,{className:"rotate-180"})]})})]})]},a.id)})})]},s.surah_number)})})]})})}export{Pe as default};
