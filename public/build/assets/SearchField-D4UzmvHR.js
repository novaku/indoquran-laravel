import{u as Y,r as i,j as t,f as Z}from"./index-BI8bnU7v.js";const k=()=>{try{return localStorage.getItem("auth_token")}catch(r){return console.warn("Failed to get auth token:",r),null}},q=r=>{try{r?localStorage.setItem("auth_token",r):localStorage.removeItem("auth_token")}catch(s){console.warn("Failed to set auth token:",s)}},$=()=>{try{localStorage.removeItem("auth_token")}catch(r){console.warn("Failed to remove auth token:",r)}},ee=()=>{const r=k();return!!(r&&r.trim().length>0)},D=()=>{const r=k();return r?{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"}:{"Content-Type":"application/json",Accept:"application/json"}},te=async(r,s={})=>{const o={...D(),...s.headers};try{const u=await fetch(r,{...s,headers:o});return u.status===401&&$(),u}catch(u){throw console.error("Authenticated fetch failed:",u),u}},re=(r,s)=>{var o;(r.status===401||(o=r.message)!=null&&o.includes("401"))&&($(),typeof s=="function"&&s())},R=r=>{if(!r||typeof r!="string")return!1;const s=r.split(".");return s.length===3&&s.every(o=>o.length>0)},H=r=>{try{if(!R(r))return null;const s=r.split(".")[1];return JSON.parse(atob(s))}catch(s){return console.warn("Failed to decode token:",s),null}},U=r=>{try{const s=H(r);return!s||!s.exp?!0:Math.floor(Date.now()/1e3)>=s.exp}catch(s){return console.warn("Failed to check token expiration:",s),!0}},ae=async()=>{const r=k();return!r||U(r)?($(),!1):!0},ne={getAuthToken:k,setAuthToken:q,removeAuthToken:$,isAuthenticated:ee,getAuthHeaders:D,authenticatedFetch:te,handleAuthError:re,isValidTokenFormat:R,getUserFromToken:H,isTokenExpired:U,refreshTokenIfNeeded:ae},le=({onSuggestionClick:r,onViewAllResults:s,surahs:o=[],className:u="",placeholder:z="Cari ayat Al-Quran berdasarkan terjemahan Indonesia...",theme:W="islamic"})=>{const g=Y(),[l,N]=i.useState(""),[d,w]=i.useState([]),[C,m]=i.useState(!1),[A,B]=i.useState(!1),[f,y]=i.useState(-1),v=i.useRef(null),T=i.useRef(null),O=async e=>{if(!e||e.length<2){w([]);return}const a=ne.getAuthToken();B(!0);try{const p=o.filter(c=>c.name_latin.toLowerCase().includes(e.toLowerCase())||c.name_indonesian.toLowerCase().includes(e.toLowerCase())||c.number.toString()===e).slice(0,3).map(c=>({type:"surah",surah:c,text:c.name_latin,highlightedText:{before:"",match:c.name_latin,after:` (${c.name_indonesian})`}})),j=await Z(`/api/search?q=${encodeURIComponent(e)}&limit=5`,{headers:{Authorization:a?`Bearer ${a}`:"","Content-Type":"application/json",Accept:"application/json"}});if(!j.ok)throw new Error("Failed to fetch suggestions");const _=await j.json();if(_.status==="success"){const c=Array.isArray(_.data)?_.data:[];if(!Array.isArray(c)){w(p);return}const X=c.map((x,se)=>{var M;if(!x||typeof x!="object")return null;const h={...x,surah_number:x.surah_number||null,number:x.number||x.ayah_number||null,text_indonesian:x.text_indonesian||""};if(!h.surah_number||!h.number)return null;let E=h.text_indonesian;const F=h.text_indonesian.toLowerCase(),I=e.toLowerCase();if(F.includes(I)){const b=F.indexOf(I);E={before:h.text_indonesian.substring(0,b),match:h.text_indonesian.substring(b,b+e.length),after:h.text_indonesian.substring(b+e.length)}}return{type:"ayah",ayah:h,surahName:((M=o.find(b=>b.number===h.surah_number))==null?void 0:M.name_latin)||`Surah ${h.surah_number}`,text:h.text_indonesian,highlightedText:E}}).filter(Boolean).slice(0,3);w([...p,...X])}}catch(p){console.error("Error fetching suggestions:",p)}finally{B(!1)}};i.useEffect(()=>{const e=setTimeout(()=>{l?O(l):w([])},300);return()=>clearTimeout(e)},[l,o]),i.useEffect(()=>{const e=a=>{v.current&&!v.current.contains(a.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[v]),i.useEffect(()=>{y(-1)},[d]),i.useEffect(()=>{if(f>=0&&T.current){const e=T.current.querySelector(`li:nth-child(${f+1})`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[f]);const K=e=>{e.preventDefault();const a=e.target.elements.search.value.trim();a&&(g(`/search?q=${encodeURIComponent(a)}`),m(!1),s&&s(a))},Q=e=>{const a=e.target.value;N(a),a.length>=2?m(!0):m(!1)},J=()=>{l&&l.length>=2&&m(!0)},P=e=>{if(!(!C||d.length===0))if(e.key==="ArrowDown")e.preventDefault(),y(a=>a<d.length-1?a+1:0);else if(e.key==="ArrowUp")e.preventDefault(),y(a=>a>0?a-1:d.length-1);else if(e.key==="Enter"&&f>=0){e.preventDefault();const a=d[f];(a.type==="ayah"&&a.ayah||a.type==="surah"&&a.surah)&&S(a)}else e.key==="Escape"&&(m(!1),y(-1))},S=i.useCallback(e=>{if(e.type==="ayah"&&e.ayah){const a=e.ayah.surah_number,p=e.ayah.number||e.ayah.ayah_number;if(a&&p){const j=`/surah/${a}/${p}`;g(j)}}else if(e.type==="surah"&&e.surah){const a=`/surah/${e.surah.number}`;g(a)}m(!1),N(""),r&&r(e)},[g,r]),V=()=>{g(`/search?q=${encodeURIComponent(l)}`),m(!1),s&&s(l)},G=()=>{N(""),w([]),m(!1),y(-1)},L={islamic:{primary:"islamic-green",primaryBorder:"islamic-green/20",primaryFocus:"islamic-green/30",primaryHover:"islamic-green/40",primaryText:"islamic-green",primaryBg:"islamic-green/5",primaryAccent:"islamic-green/10"},amber:{primary:"amber-500",primaryBorder:"amber-200",primaryFocus:"amber-300",primaryHover:"amber-300",primaryText:"amber-600",primaryBg:"amber-50",primaryAccent:"amber-100"}},n=L[W]||L.islamic;return t.jsx("div",{className:`relative w-full ${u}`,children:t.jsx("form",{onSubmit:K,className:"flex items-center",children:t.jsxs("div",{className:"relative w-full",ref:v,children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-${n.primaryText}`,viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),t.jsx("input",{type:"text",name:"search",value:l,onChange:Q,onFocus:J,onKeyDown:P,placeholder:z,className:`w-full pl-12 pr-12 py-4 rounded-xl border-2 border-${n.primaryBorder} focus:outline-none focus:ring-2 focus:ring-${n.primaryFocus} focus:border-${n.primaryHover} shadow-md text-base bg-white/80 backdrop-blur-sm hover:shadow-lg transition-shadow`}),l&&t.jsx("button",{type:"button",onClick:G,className:`absolute right-4 top-1/2 -translate-y-1/2 text-${n.primaryText}/60 hover:text-${n.primaryText} transition-colors`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),C&&l.length>=2&&t.jsxs("div",{className:`absolute mt-2 w-full bg-white rounded-xl shadow-lg max-h-96 overflow-y-auto border border-${n.primaryBorder} z-50`,ref:T,children:[A?t.jsxs("div",{className:`p-4 text-center text-${n.primaryText}`,children:[t.jsx("div",{className:`inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-${n.primaryText} mr-2`}),"Mencari..."]}):d.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`px-4 py-2 border-b border-${n.primaryBorder} bg-${n.primaryBg}`,children:t.jsxs("h3",{className:`text-xs font-medium text-${n.primaryText}`,children:['Hasil Pencarian untuk "',l,'"']})}),t.jsx("ul",{className:"py-2",children:d.map((e,a)=>t.jsx("li",{onClick:()=>S(e),className:`px-4 py-3 hover:bg-${n.primaryBg} cursor-pointer border-b border-gray-100 last:border-b-0 ${f===a?`bg-${n.primaryBg}`:""} transition-colors duration-150`,onMouseEnter:()=>y(a),children:e.type==="surah"?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${n.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),t.jsx("span",{className:"font-medium",children:e.surah.name_latin}),t.jsx("span",{className:"mx-1.5",children:"•"}),t.jsx("span",{children:e.surah.name_indonesian}),t.jsx("span",{className:"mx-1.5",children:"•"}),t.jsxs("span",{children:[e.surah.total_ayahs," ayat"]}),t.jsx("span",{className:`ml-auto text-xs text-${n.primaryText} bg-${n.primaryAccent} px-2 py-0.5 rounded-full`,children:"Baca Surah →"})]}),t.jsxs("p",{className:"text-gray-600 text-sm",children:[e.surah.revelation_place," • Surah ke-",e.surah.number]})]}):e.ayah?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${n.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-1l-4 4z"})}),t.jsx("span",{className:"font-medium",children:e.surahName}),t.jsx("span",{className:"mx-1.5",children:"•"}),t.jsxs("span",{children:["Ayat ",e.ayah.number||e.ayah.ayah_number]}),t.jsx("span",{className:`ml-auto text-xs text-${n.primaryText} bg-${n.primaryAccent} px-2 py-0.5 rounded-full`,children:"Lihat ayat →"})]}),t.jsxs("p",{className:"text-gray-700 text-sm overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[t.jsx("span",{className:`text-${n.primaryText} font-medium`,children:"Terjemahan: "}),typeof e.highlightedText=="object"?t.jsxs("span",{children:['"',e.highlightedText.before,t.jsx("span",{className:"bg-yellow-100 font-medium px-0.5 rounded-sm",children:e.highlightedText.match}),e.highlightedText.after,'"']}):`"${e.text}"`]})]}):t.jsx("div",{className:"p-2 text-sm text-gray-500",children:"Data tidak lengkap"})},`${e.type}-${a}`))})]}):t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:`text-${n.primaryText}/70 mb-3 font-medium`,children:"Tidak ada hasil yang cocok"}),t.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:'Coba gunakan kata kunci lain atau cari berdasarkan isi ayat. Contoh: "rahmat", "kasih sayang", "rezeki"'})]}),!A&&d.length>0&&t.jsx("div",{className:`p-4 border-t border-${n.primaryBorder}`,children:t.jsxs("button",{onClick:V,className:`w-full py-3 px-4 bg-${n.primaryAccent} hover:bg-${n.primaryBg} text-${n.primaryText} font-medium rounded-xl transition-all duration-300 flex items-center justify-center shadow-sm hover:shadow`,type:"button",children:[t.jsx("span",{children:"Lihat Semua Hasil"}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})]})})})};export{le as S,ne as a};
