import{m as W,l as D,u as V,r,f as X,j as e,P as N,L as Y,S as ee,y as I,R as se,s as ae,t as te,v as re,x as ne,w as le,A as ie,B as oe,z as de}from"./index-D2Fhmilt.js";import{t as ce}from"./BookmarkService-CID8N5PC.js";import"./vendor-BEN4boU2.js";function pe(){const{user:u}=W(),{number:n}=D(),d=V(),[l,C]=r.useState(null),[O,y]=r.useState(!0),[v,h]=r.useState(null),[w,ue]=r.useState(604),[p,$]=r.useState(""),[E,c]=r.useState(!1),[o,m]=r.useState(null),[B,x]=r.useState(null),[g,f]=r.useState(2.5),[H,A]=r.useState({}),[j,S]=r.useState(null),[me,_]=r.useState(!1),L=r.useRef(null);r.useEffect(()=>{n&&Q(n)},[n]);const Q=async a=>{try{y(!0),h(null);const t=await(await X(`/api/pages/${a}`)).json();if(t.status==="success"){if(C(t.data),u&&t.data.surahs){const i=t.data.surahs.flatMap(k=>k.ayahs);J(i)}}else h(t.message||"Failed to load page data")}catch(s){console.error("Error loading page data:",s),h("Failed to load page data. Please try again.")}finally{y(!1)}};r.useEffect(()=>{var a;if(((a=l==null?void 0:l.surahs)==null?void 0:a.length)>0){const s=l.surahs[0].ayahs[0];if(s!=null&&s.audio_urls){const t=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;let i;if(Array.isArray(t)){const k=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];i=t.map((xe,P)=>k[P]||`qari_${P+1}`)}else i=Object.keys(t);i.length>0&&!p&&$(i[0])}}},[l,p]),r.useEffect(()=>()=>{o&&(o.pause(),c(!1),m(null))},[]);const R=r.useCallback(()=>{f(a=>Math.min(a+.25,6))},[]),F=r.useCallback(()=>{f(a=>Math.max(a-.25,1.5))},[]),z=r.useCallback(()=>{f(2.5)},[]),T=()=>{const a=parseInt(n);a>1&&d(`/pages/${a-1}`,{replace:!0})},U=()=>{const a=parseInt(n);a<w&&d(`/pages/${a+1}`,{replace:!0})},q=(a,s)=>{o&&(o.pause(),c(!1),x(null));const t=new Audio(a);L.current=t,t.play().then(()=>{c(!0),m(t),x(s),t.onended=()=>{c(!1),m(null),x(null)}}).catch(i=>{console.error("Audio playback error:",i)})},M=()=>{o&&(o.pause(),c(!1),m(null),x(null))},Z=a=>{if(!a.audio_urls)return null;const s=typeof a.audio_urls=="string"?JSON.parse(a.audio_urls):a.audio_urls;return Array.isArray(s)?s[0]:typeof s=="object"?s[p]||Object.values(s)[0]:null},J=async a=>{if(!(!u||!Array.isArray(a)||a.length===0)){_(!0);try{const s=a.map(t=>t.id).filter(t=>t);if(s.length>0){const t=await b(s);A(t)}}catch(s){console.error("Error loading bookmark statuses:",s)}finally{_(!1)}}},G=async a=>{if(!u){alert("Silakan login untuk menggunakan fitur bookmark");return}if(!a.id){console.error("Ayah ID not found");return}if(j!==a.id){S(a.id);try{const s=await ce(a.id);s.status==="success"&&A(t=>({...t,[a.id]:{is_bookmarked:s.data.is_bookmarked,is_favorite:s.data.is_favorite}}))}catch(s){console.error("Error toggling bookmark:",s),alert("Gagal mengubah status bookmark. Silakan coba lagi.")}finally{S(null)}}},b=a=>H[a]||{is_bookmarked:!1,is_favorite:!1};if(O)return e.jsx(N,{isLoading:!0,children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(Y,{size:"lg"})})})})});if(v)return e.jsx(N,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-xl p-8 border border-red-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600 mb-4",children:v}),e.jsx("button",{onClick:()=>d(-1),className:"bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors",children:"Kembali"})]})})})})});if(!l)return null;const K={title:`Halaman ${n} Al-Quran - IndoQuran`,description:`Baca Halaman ${n} Al-Quran lengkap dengan terjemahan bahasa Indonesia, audio murottal, dan tafsir. ${l.total_ayahs} ayat tersedia untuk dipelajari.`,keywords:`halaman ${n}, al quran halaman ${n}, terjemahan halaman ${n}, quran digital, al quran indonesia`};return e.jsxs(N,{children:[e.jsx(ee,{...K}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 mb-8 border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>d(-1),className:"p-2 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 transition-all duration-200 border border-green-200",children:e.jsx(I,{className:"text-xl"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl",children:e.jsx(se,{className:"text-2xl"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-green-800",children:["Halaman ",n]}),e.jsxs("p",{className:"text-green-600",children:[l.total_ayahs," ayat dari ",l.surahs.length," surah"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan teks Arab dari Halaman ",n]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Ukuran Teks:"}),e.jsx("button",{onClick:F,disabled:g<=1.5,className:"p-2 rounded-md bg-white border border-green-200 text-green-700 hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perkecil teks Arab",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:z,className:"px-3 py-2 rounded-md bg-white border border-green-200 text-green-700 hover:bg-green-50 transition-colors text-xs font-medium",title:"Reset ukuran teks Arab",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:R,disabled:g>=6,className:"p-2 rounded-md bg-white border border-green-200 text-green-700 hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perbesar teks Arab",children:e.jsx(re,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"space-y-8",children:l.surahs.map(a=>e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-green-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:a.surah.name_latin}),e.jsx("p",{className:"text-green-100 text-lg",children:a.surah.name_arabic})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-green-200",children:"Surah"}),e.jsxs("div",{className:"text-2xl font-bold",children:["#",a.surah.number]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:a.ayahs.map(s=>e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 text-green-700 rounded-full text-sm font-semibold",children:s.ayah_number}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Ayat ",s.ayah_number]})]}),e.jsx("button",{onClick:()=>d(`/surah/${s.surah_number}/${s.ayah_number}`),className:"opacity-0 group-hover:opacity-100 transition-opacity text-green-600 hover:text-green-800 text-sm font-medium",children:"Lihat Detail →"})]}),e.jsx("div",{className:"bg-green-50/70 rounded-2xl p-6 text-center",children:e.jsx("p",{className:"text-right leading-relaxed font-arabic text-gray-800",style:{fontSize:`${g}rem`,lineHeight:g>3?"1.8":"1.6"},dir:"rtl",children:s.text_arabic})}),e.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.audio_urls&&e.jsx(e.Fragment,{children:E&&B===s.id?e.jsx("button",{onClick:M,className:"p-2 rounded-md bg-green-50 text-green-700 hover:bg-green-100 transition-colors border border-green-200",title:"Pause Audio",children:e.jsx(ne,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>{const t=Z(s);t&&q(t,s.id)},className:"p-2 rounded-md bg-green-50 text-green-700 hover:bg-green-100 transition-colors border border-green-200",title:"Play Audio",children:e.jsx(le,{className:"w-5 h-5"})})}),u&&e.jsx("button",{onClick:()=>G(s),disabled:j===s.id,className:`p-2 rounded-md border transition-colors disabled:opacity-50 ${b(s.id).is_bookmarked?"bg-yellow-500 text-white border-yellow-600 hover:bg-yellow-600":"bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100"}`,title:b(s.id).is_bookmarked?"Hapus bookmark":"Tambah bookmark",children:j===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t border-b border-current"}):b(s.id).is_bookmarked?e.jsx(ie,{className:"w-4 h-4"}):e.jsx(oe,{className:"w-4 h-4"})})]})]},`${s.surah_number}-${s.ayah_number}`))})})]},a.surah.number))}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("button",{onClick:T,disabled:parseInt(n)<=1,className:"flex items-center gap-2 px-6 py-3 rounded-lg bg-green-600 text-white font-medium disabled:opacity-50 hover:bg-green-700 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),"Halaman Sebelumnya"]}),e.jsxs("button",{onClick:U,disabled:parseInt(n)>=w,className:"flex items-center gap-2 px-6 py-3 rounded-lg bg-green-600 text-white font-medium disabled:opacity-50 hover:bg-green-700 transition-colors",children:["Halaman Selanjutnya",e.jsx(de,{className:"w-5 h-5"})]})]})]})})]})}export{pe as default};
