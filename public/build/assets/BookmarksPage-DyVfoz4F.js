import{u as xe,g as be,r as n,j as e,x as z,E as fe,F as T,G as U,z as D,p as F,o as J,v as L,q as pe,s as ye,t as je,w as Ne,H as ve,J as Se,C as we}from"./index-DXRd98RQ.js";import{g as Ae,u as _e}from"./BookmarkService-CRH7-22w.js";import"./vendor-DavUf6mE.js";function ke(){const p=xe(),{user:A}=be(),[c,y]=n.useState([]),[K,_]=n.useState(!0),[u,Z]=n.useState(""),[C,j]=n.useState(null),[O,g]=n.useState(""),[I,E]=n.useState(!1),[k,V]=n.useState(new Set),[B,M]=n.useState(new Set),[h,x]=n.useState(new Set),[W,X]=n.useState(!0),[N,v]=n.useState(2.5),[b,Q]=n.useState(""),[S,d]=n.useState(!1),[i,f]=n.useState(null),[P,o]=n.useState(null),Y=n.useRef(null);n.useEffect(()=>{if(!A){p("/auth/login");return}H()},[A,p]),n.useEffect(()=>()=>{i&&(i.pause(),d(!1),f(null),o(null))},[i]),n.useEffect(()=>{if(c.length>0){const s=c.find(a=>a.audio_urls);if(s){const a=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;let t;if(Array.isArray(a)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];t=a.map((m,q)=>r[q]||`qari_${q+1}`)}else t=Object.keys(a);t.length>0&&!b&&Q(t[0])}}},[c]);const G=()=>{v(s=>Math.min(s+.5,6))},ee=()=>{v(s=>Math.max(s-.5,1.5))},se=()=>{v(2.5)},ae=()=>({fontSize:`${N}rem`,lineHeight:"2",textShadow:"0 1px 1px rgba(0,0,0,0.05)"}),te=(s,a)=>{i&&(i.pause(),d(!1),o(null));const t=new Audio(s);Y.current=t,t.play().then(()=>{d(!0),f(t),o(a),t.onended=()=>{d(!1),f(null),o(null)}}).catch(r=>{console.error("Error playing audio:",r),d(!1),o(null)})},$=()=>{i&&(i.pause(),d(!1),f(null),o(null))},re=s=>{Q(s),S&&$()},R=s=>{if(!s?.audio_urls)return[];const a=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;if(Array.isArray(a)){const t=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];return a.map((r,m)=>t[m]||`qari_${m+1}`)}else return Object.keys(a)},ne=s=>{if(!s?.audio_urls)return null;const a=typeof s.audio_urls=="string"?JSON.parse(s.audio_urls):s.audio_urls;if(Array.isArray(a)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"].indexOf(b);return r!==-1?a[r]:a[0]}else return a[b]||Object.values(a)[0]},le=s=>({"01":"Abdullah Al-Juhany","02":"Abdul Muhsin Al-Qasim","03":"Abdurrahman As-Sudais","04":"Ibrahim Al-Dossari","05":"Mishary Rashid Alafasy","06":"Maher Al Mueaqly","07":"Ahmed ibn Ali al-Ajamy","08":"Hani Ar-Rifai","09":"Mahmoud Khalil Al-Husary",10:"Mohamed Siddiq El-Minshawi",husary:"Mahmoud Khalil Al-Husary",sudais:"Abdurrahman As-Sudais",alafasy:"Mishary Rashid Alafasy",minshawi:"Mohamed Siddiq El-Minshawi",abdulbasit:"Abdul Basit Abdul Samad",maher:"Maher Al Mueaqly",ghamdi:"Saad Al Ghamdi",shuraim:"Saud Ash-Shuraim",ajmy:"Ahmed ibn Ali al-Ajamy",walk:"Hani Ar-Rifai"})[s]||`Qari ${s}`,H=async()=>{_(!0);try{const s=await Ae(!1);if(Array.isArray(s)){if(y(s),W&&s.length>0){const a=[...new Set(s.map(r=>r.surah_number))];x(new Set(a));const t=s.map(r=>r.id);M(new Set(t)),X(!1)}}else console.error("Invalid bookmarks data received:",s),y([])}catch(s){console.error("Error loading bookmarks:",s),y([])}finally{_(!1)}},ie=s=>{j(s.id),g(s.pivot?.notes||"")},de=async s=>{E(!0);try{await _e(s,O),await H(),j(null),g("")}catch(a){console.error("Error saving notes:",a)}finally{E(!1)}},oe=()=>{j(null),g("")},ce=s=>{V(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},ue=s=>{M(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},he=s=>{x(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},me=()=>{x(new Set)},ge=()=>{const s=l.map(a=>a.surah_number);x(new Set(s))},l=(()=>{if(!Array.isArray(c))return[];const s=c.filter(t=>{if(!u)return!0;const r=u.toLowerCase();return t.text_indonesian?.toLowerCase().includes(r)||t.surah?.name_indonesian?.toLowerCase().includes(r)||t.ayah_number?.toString().includes(r)||t.surah_number?.toString().includes(r)}),a={};return s.forEach(t=>{const r=t.surah_number;a[r]||(a[r]={surah:t.surah,surah_number:r,ayahs:[]}),a[r].ayahs.push(t)}),Object.values(a).sort((t,r)=>t.surah_number-r.surah_number).map(t=>({...t,ayahs:t.ayahs.sort((r,m)=>r.ayah_number-m.ayah_number)}))})(),w=l.filter(s=>!h.has(s.surah_number));return K?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:[e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-8 mb-8 border border-green-100",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 transition-all duration-200 border border-green-200",children:e.jsx(z,{className:"text-xl"})}),e.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"Bookmark Ayat"})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-400"}),e.jsx("input",{type:"text",placeholder:"Cari ayat atau surah...",value:u,onChange:s=>Z(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-green-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:l.length>0&&e.jsxs("div",{className:"text-sm text-green-600",children:[w.length," dari ",l.length," surah ditampilkan"]})}),l.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50/50 rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800",children:"Kontrol Tampilan Surah:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:me,className:"flex items-center gap-1 px-3 py-1 text-xs bg-green-100 border border-green-300 text-green-800 rounded hover:bg-green-200 transition-colors",children:[e.jsx(T,{}),"Tampilkan Semua"]}),e.jsxs("button",{onClick:ge,className:"flex items-center gap-1 px-3 py-1 text-xs bg-gray-100 border border-gray-300 text-gray-800 rounded hover:bg-gray-200 transition-colors",children:[e.jsx(U,{}),"Sembunyikan Semua"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",children:l.map(s=>e.jsxs("button",{onClick:()=>he(s.surah_number),className:`flex items-center gap-2 px-3 py-2 text-xs rounded-lg border transition-all duration-200 ${h.has(s.surah_number)?"bg-gray-100 border-gray-300 text-gray-600 hover:bg-gray-200":"bg-green-100 border-green-300 text-green-800 hover:bg-green-200"}`,title:`${s.surah?.name_indonesian||`Surah ${s.surah_number}`} (${s.ayahs.length} ayat)`,children:[h.has(s.surah_number)?e.jsx(U,{className:"flex-shrink-0"}):e.jsx(T,{className:"flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.surah_number,". ",s.surah?.name_indonesian?.substring(0,8)||`Surah ${s.surah_number}`]}),e.jsxs("span",{className:"text-xs opacity-75",children:["(",s.ayahs.length,")"]})]},s.surah_number))})]})]}),w.length===0?e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl p-12 border border-green-100 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(D,{className:"text-6xl text-green-300 mx-auto"})}),e.jsx("h3",{className:"text-xl font-semibold text-green-700 mb-2",children:u?"Tidak ada hasil yang ditemukan":h.size===l.length&&l.length>0?"Semua surah disembunyikan":"Belum ada bookmark"}),e.jsx("p",{className:"text-green-600",children:u?"Coba kata kunci yang berbeda":h.size===l.length&&l.length>0?"Gunakan kontrol surah untuk menampilkan bookmark":"Simpan ayat dengan menekan tombol bookmark"})]}):e.jsx("div",{className:"space-y-6",children:w.map(s=>e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-green-100",children:[e.jsx("div",{className:"p-6 border-b border-green-100 cursor-pointer hover:bg-green-50/50 transition-colors rounded-t-3xl",onClick:()=>ce(s.surah_number),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-green-800",children:s.surah?.name_indonesian||`Surah ${s.surah_number}`}),e.jsxs("span",{className:"text-green-600 font-medium",children:["(",s.ayahs.length," ayat)"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:k.has(s.surah_number)?e.jsx(F,{className:"text-xl text-green-600"}):e.jsx(J,{className:"text-xl text-green-600"})})]})}),!k.has(s.surah_number)&&e.jsx("div",{className:"divide-y divide-green-100",children:s.ayahs.map(a=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 cursor-pointer p-2 rounded-lg hover:bg-green-50/50 transition-colors",onClick:()=>ue(a.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-semibold text-green-800",children:["Ayat ",a.ayah_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"text-green-500",title:"Bookmark"}),a.is_favorite&&e.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full border border-red-200",children:"Favorit"}),S&&P===a.id&&e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full border border-blue-200 flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),"Playing"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:B.has(a.id)?e.jsx(F,{className:"text-lg text-green-600"}):e.jsx(J,{className:"text-lg text-green-600"})})]}),!B.has(a.id)&&e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"bg-green-50/70 rounded-2xl p-6 mb-6 text-center relative",children:[e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[e.jsx("button",{onClick:ee,disabled:N<=1.5,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perkecil teks Arab",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:se,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors text-xs font-medium",title:"Reset ukuran teks Arab",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:G,disabled:N>=6,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perbesar teks Arab",children:e.jsx(je,{className:"w-4 h-4"})})]}),a.audio_urls&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[R(a).length>1&&e.jsx("select",{value:b,onChange:t=>re(t.target.value),className:"p-1.5 text-xs rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500",title:"Pilih Qari",children:R(a).map(t=>e.jsx("option",{value:t,children:le(t)},t))}),S&&P===a.id?e.jsx("button",{onClick:$,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors",title:"Pause Audio",children:e.jsx(Ne,{className:"w-5 h-5"})}):e.jsx("button",{onClick:()=>{const t=ne(a);t&&te(t,a.id)},className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors",title:"Play Audio",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"font-arabic text-green-800 leading-loose pt-8",style:ae(),dir:"rtl",children:a.text_arabic})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-green-700 leading-relaxed",children:a.text_indonesian})}),a.text_latin&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-green-600 italic text-sm",children:a.text_latin})}),e.jsxs("div",{className:"mt-6 p-4 bg-green-50 rounded-2xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Catatan:"}),C!==a.id&&e.jsx("button",{onClick:()=>ie(a),className:"p-1 rounded-md bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 transition-all duration-200 border border-green-200",title:"Edit catatan",children:e.jsx(ve,{className:"text-lg"})})]}),C===a.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:O,onChange:t=>g(t.target.value),placeholder:"Tambahkan catatan untuk ayat ini...",className:"w-full p-2 text-sm border border-green-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:"3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>de(a.id),disabled:I,className:"flex items-center gap-1 px-3 py-1 bg-green-100 border border-green-300 text-green-800 text-sm rounded hover:bg-green-200 disabled:opacity-50 transition-colors",children:[e.jsx(Se,{}),I?"Menyimpan...":"Simpan"]}),e.jsxs("button",{onClick:oe,className:"flex items-center gap-1 px-3 py-1 bg-gray-100 border border-gray-300 text-gray-800 text-sm rounded hover:bg-gray-200 transition-colors",children:[e.jsx(we,{}),"Batal"]})]})]}):e.jsx("p",{className:"text-green-700 text-sm",children:a.pivot?.notes||"Klik tombol edit untuk menambahkan catatan..."})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-green-200",children:e.jsxs("a",{href:`/surah/${a.surah_number}`,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-50 text-green-800 hover:bg-green-100 font-medium transition-all duration-200 border border-green-200",children:["Baca Surah",e.jsx(z,{className:"rotate-180"})]})})]})]},a.id))})]},s.surah_number))})]})})}export{ke as default};
