import{k as Se,i as Ce,u as Te,r as n,f as Ie,j as e,m as Me,n as se,o as ae,p as $e,q as Oe,s as Ee,t as Fe,v as Be,w as Pe,x as Qe,y as F,z as te,A as Re,B as ze}from"./index-mNSB7Tgo.js";import{t as De}from"./BookmarkService-Cfk_G7sU.js";import"./vendor-BEN4boU2.js";const B={},Le=async c=>{if(B[c])return B[c];try{await new Promise(f=>setTimeout(f,300));const m=`Ini adalah catatan kaki dengan ID ${c}`;return B[c]=m,m}catch(m){return console.error("Error fetching footnote:",m),`Catatan kaki #${c}`}},He=n.memo(({ayah:c,surah:m,ayahFontSize:f,isBookmarked:N,onBookmarkToggle:l,onPlayAudio:S,isPlaying:t,onOpenFootnote:P})=>e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-green-100 mb-6 overflow-hidden"}));He.displayName="MemoizedAyahCard";function Ke(){const{user:c}=Se(),{number:m,ayahNumber:f}=Ce(),N=Te(),[l,S]=n.useState(null),[t,P]=n.useState(null),[g,Q]=n.useState({}),[R,C]=n.useState(!0),[z,w]=n.useState(null),[i,p]=n.useState(1),[T,D]=n.useState(0),[I,re]=n.useState(!1),[y,L]=n.useState(""),[H,j]=n.useState(!1),[u,v]=n.useState(null),[A,ne]=n.useState(!1),[M,$]=n.useState(3),[oe,U]=n.useState({}),[le,q]=n.useState(!1),[x,J]=n.useState(null),[ie,K]=n.useState(!1),[de,G]=n.useState(null),[ce,_]=n.useState(""),[me,V]=n.useState(!1),O=n.useRef({}),h=n.useRef(null);n.useEffect(()=>{if(!m)return;C(!0),w(null);const s=f?parseInt(f):1;if(p(s),O.current[m]){const a=O.current[m];S(a.surah),Q(a.ayahs),D(a.surah.total_ayahs),C(!1);return}Ie(`/api/surahs/${m}`).then(a=>a.json()).then(a=>{let r,o;if(a.status==="success"&&a.data)r=a.data.surah||a.data,o=a.data.ayahs||[];else if(a.ayahs)r=a,o=a.ayahs||[];else throw new Error("Unexpected API response format");const d={};Array.isArray(o)&&o.length>0&&o.forEach((k,Ae)=>{const _e=k.ayah_number||k.number||Ae+1;d[_e]=k}),O.current[m]={surah:r,ayahs:d},S(r),Q(d),D(r.total_ayahs),c&&Object.keys(d).length>0&&pe(Object.values(d))}).catch(a=>{w(a.message)}).finally(()=>C(!1))},[m]),n.useEffect(()=>{if(!i||!g||Object.keys(g).length===0)return;const s=g[i];if(s)P(s),w(null);else{const a=Object.keys(g).map(r=>parseInt(r)).sort((r,o)=>r-o);if(a.length>0){const r=a[0];p(r);return}console.error("❌ SurahPage - No ayah found:",i),w(`Ayat ${i} tidak ditemukan`)}},[i,g]);const ue=s=>{s!==i&&(p(s),N(`/surah/${m}/${s}`,{replace:!0}),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},100))},he=()=>{if(i>1){const s=i-1;p(s),N(`/surah/${m}/${s}`,{replace:!0}),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},100)}},ge=()=>{if(i<T){const s=i+1;p(s),N(`/surah/${m}/${s}`,{replace:!0}),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},100)}};n.useEffect(()=>()=>{u&&(u.pause(),j(!1),v(null))},[i]),n.useEffect(()=>()=>{u&&u.pause()},[]),n.useEffect(()=>{if(t!=null&&t.audio_urls){const s=typeof t.audio_urls=="string"?JSON.parse(t.audio_urls):t.audio_urls;let a;if(Array.isArray(s)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];a=s.map((o,d)=>r[d]||`qari_${d+1}`)}else a=Object.keys(s);a.length>0&&(!y||!a.includes(y))&&L(a[0])}},[t]);const xe=s=>{u&&u.pause();const a=new Audio(s);a.play().then(()=>{j(!0),v(a),a.onended=()=>{j(!1),v(null)}}).catch(r=>{console.error("Error playing audio:",r),j(!1)})},W=()=>{u&&(u.pause(),j(!1),v(null))},be=s=>{L(s),H&&W()},Z=()=>{if(!(t!=null&&t.audio_urls))return[];const s=typeof t.audio_urls=="string"?JSON.parse(t.audio_urls):t.audio_urls;if(Array.isArray(s)){const a=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"];return s.map((r,o)=>a[o]||`qari_${o+1}`)}else return Object.keys(s)},X=()=>{if(!(t!=null&&t.audio_urls))return null;const s=typeof t.audio_urls=="string"?JSON.parse(t.audio_urls):t.audio_urls;if(Array.isArray(s)){const r=["alafasy","sudais","husary","minshawi","abdulbasit","maher","ghamdi","shuraim","ajmy","walk"].indexOf(y);return r!==-1?s[r]:s[0]}else return s[y]||Object.values(s)[0]},fe=s=>({"01":"Abdullah Al-Juhany","02":"Abdul Muhsin Al-Qasim","03":"Abdurrahman As-Sudais","04":"Ibrahim Al-Dossari","05":"Mishary Rashid Alafasy","06":"Maher Al Mueaqly","07":"Ahmed ibn Ali al-Ajamy","08":"Hani Ar-Rifai","09":"Mahmoud Khalil Al-Husary",10:"Mohamed Siddiq El-Minshawi",husary:"Mahmoud Khalil Al-Husary",sudais:"Abdurrahman As-Sudais",alafasy:"Mishary Rashid Alafasy",minshawi:"Mohamed Siddiq El-Minshawi",abdulbasit:"Abdul Basit Abdul Samad",maher:"Maher Al Mueaqly",ghamdi:"Saad Al Ghamdi",shuraim:"Saud Ash-Shuraim",ajmy:"Ahmed ibn Ali al-Ajamy",walk:"Hani Ar-Rifai"})[s]||`Qari ${s}`,pe=async s=>{if(!(!c||!Array.isArray(s)||s.length===0)){q(!0);try{const a=s.map(r=>r.id).filter(r=>r);if(a.length>0){const r=await b(a);U(r)}}catch(a){console.error("Error loading bookmark statuses:",a)}finally{q(!1)}}},Y=async s=>{if(!c){alert("Silakan login untuk menggunakan fitur bookmark");return}if(!s.id){console.error("Ayah ID not found");return}if(x!==s.id){J(s.id);try{const a=await De(s.id);a.status==="success"&&U(r=>({...r,[s.id]:{is_bookmarked:a.data.is_bookmarked,is_favorite:a.data.is_favorite}}))}catch(a){console.error("Error toggling bookmark:",a),alert("Gagal mengubah status bookmark. Silakan coba lagi.")}finally{J(null)}}},b=s=>oe[s]||{is_bookmarked:!1,is_favorite:!1},ye=()=>{if(!t||!l)return;let s=`🕌 *${l.name_latin}* (${l.name_arabic})
`;s+=`📖 Ayat ${i}

`,s+=`🔤 *Arab:*
${t.text_arabic}

`,t.text_latin&&(s+=`🔤 *Transliterasi:*
${t.text_latin}

`);const a=t.text_indonesian||t.translation_id;a&&(s+=`🇮🇩 *Terjemahan Indonesia:*
${a}

`),t.translation_en&&(s+=`🇺🇸 *English Translation:*
${t.translation_en}

`);const r=window.location.href;s+=`🔗 Baca selengkapnya: ${r}

`,s+="📱 Dibagikan dari IndoQuran";const d=`https://wa.me/?text=${encodeURIComponent(s)}`;window.open(d,"_blank")},je=()=>{$(s=>Math.min(s+.5,6))},ke=()=>{$(s=>Math.max(s-.5,1.5))},Ne=()=>{$(3)},we=()=>({fontSize:`${M}rem`}),ve=async s=>{G(s),K(!0),V(!0),_("");try{const a=await Le(s);_(a)}catch(a){console.error("Error loading footnote:",a),_("Gagal memuat catatan kaki.")}finally{V(!1)}},E=()=>{K(!1),G(null),_("")},ee=s=>s?{__html:s.replace(/<sup\s+foot_note=(\d+)>(\d+)<\/sup>/g,(r,o,d)=>`<sup foot_note="${o}" class="footnote-reference cursor-pointer text-blue-600 hover:text-blue-800 underline" onclick="window.handleFootnoteClick && window.handleFootnoteClick('${o}')">${d}</sup>`)}:{__html:s};return n.useEffect(()=>(window.handleFootnoteClick=ve,()=>{delete window.handleFootnoteClick}),[]),R?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):z||!l?e.jsxs("div",{className:"bg-accent-50 text-accent-700 p-4 rounded-lg shadow-lg",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Kesalahan! "}),e.jsx("span",{className:"block sm:inline",children:z||"Surah tidak ditemukan"})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 pt-24 pb-20",children:[e.jsx("div",{className:"bg-white rounded-3xl shadow-xl p-8 mb-8 border border-green-100",children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4 mb-3",children:[e.jsxs("h2",{className:"text-2xl font-bold text-green-800",children:[l.name_latin," ",e.jsxs("span",{className:"text-gray-500 font-normal",children:["(",l.name_arabic,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sedang membaca:"}),e.jsxs("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-gradient-to-r from-amber-500 to-orange-500 text-white border-2 border-amber-600 shadow-lg",children:[e.jsx("span",{className:"mr-1",children:"📖"})," Ayat ",i]})]})]}),e.jsxs("div",{className:"text-gray-600 text-sm mb-1",children:[l.name_indonesian," • ",l.revelation_place," • ",l.total_ayahs," ayat"]})]})}),(l.description_short||l.description_long)&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-green-100 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-green-800 flex items-center gap-2",children:[e.jsx(Me,{className:"text-green-600"}),"Tentang Surah ",l.name_latin]}),e.jsxs("button",{onClick:()=>ne(!A),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg text-green-700 hover:text-green-800 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium",children:A?"Sembunyikan":"Tampilkan"}),A?e.jsx(se,{}):e.jsx(ae,{})]})]}),A&&e.jsxs("div",{className:"space-y-4",children:[l.description_short&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-100",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"Ringkasan:"}),e.jsx("div",{className:"text-green-700 text-sm leading-relaxed prose prose-sm max-w-none prose-green",dangerouslySetInnerHTML:{__html:l.description_short}})]}),l.description_long&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-100",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"Penjelasan Lengkap:"}),e.jsx("div",{className:"text-green-700 text-sm leading-relaxed prose prose-sm max-w-none prose-green",dangerouslySetInnerHTML:{__html:l.description_long}})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-8 border border-green-100 text-center mb-8",children:R?e.jsxs("div",{className:"flex justify-center items-center mb-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Memuat surah dan ayat..."})]}):t?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-center gap-3 mb-4",children:[t.juz&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200",children:["Juz ",t.juz]}),t.page&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200",children:["Halaman ",t.page]}),e.jsxs("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-gradient-to-r from-green-600 to-emerald-600 text-white border-2 border-green-700 shadow-lg ring-2 ring-green-200 ring-opacity-50",children:[e.jsx("span",{className:"mr-1",children:"📖"})," Ayat ",i]})]}),e.jsxs("div",{className:"mb-4 p-6 bg-green-50/70 rounded-2xl border border-green-100 relative text-center",children:[e.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[e.jsx("button",{onClick:ke,disabled:M<=1.5,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perkecil teks Arab",children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Ne,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 transition-colors text-xs font-medium",title:"Reset ukuran teks Arab",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:je,disabled:M>=6,className:"p-1.5 rounded-md bg-white/80 border border-green-200 text-green-700 hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Perbesar teks Arab",children:e.jsx(Ee,{className:"w-4 h-4"})})]}),e.jsx("div",{ref:h,id:"arabic-text",className:"font-arabic text-green-800 text-right leading-loose pt-8",style:we(),dir:"rtl",children:t.text_arabic})]}),t.text_latin&&e.jsxs("div",{className:"text-lg italic text-green-600 mb-3 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-1",children:"Transliterasi:"}),t.text_latin]}),e.jsxs("div",{className:"text-lg text-green-700 mb-3 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx("div",{className:"text-sm font-medium text-green-800 mb-1",children:"Terjemahan Indonesia:"}),e.jsx("div",{dangerouslySetInnerHTML:ee(t.text_indonesian||t.translation_id)})]}),t.translation_en&&e.jsxs("div",{className:"text-sm text-green-600 mb-4 p-3 bg-green-50 rounded-lg border border-green-100",children:[e.jsx("div",{className:"text-sm font-medium text-green-700 mb-1",children:"English Translation:"}),e.jsx("div",{dangerouslySetInnerHTML:ee(t.translation_en)})]}),t.audio_urls&&Z().length>0&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border border-green-100",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-green-800",children:"Qari:"}),e.jsx("select",{value:y||"",onChange:s=>be(s.target.value),className:"px-3 py-1 text-sm rounded-md border border-green-200 bg-white focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Z().map(s=>e.jsx("option",{value:s,children:fe(s)},s))})]}),e.jsx("div",{className:"flex items-center gap-2",children:H?e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(Be,{className:"w-5 h-5"}),"Berhenti"]}):e.jsxs("button",{onClick:()=>xe(X()),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",disabled:!X(),children:[e.jsx(Fe,{className:"w-5 h-5"}),"Putar"]})})]})}),t.tafsir&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border border-green-100",children:[e.jsxs("button",{onClick:()=>re(!I),className:"flex items-center justify-between w-full text-left",children:[e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Tafsir"}),I?e.jsx(se,{className:"w-4 h-4 text-green-600"}):e.jsx(ae,{className:"w-4 h-4 text-green-600"})]}),I&&e.jsx("div",{className:"mt-3 text-sm text-green-700 leading-relaxed text-left",children:t.tafsir})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-6",children:[e.jsxs("button",{onClick:he,disabled:i<=1,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-green-100 text-green-700 font-medium disabled:opacity-50 hover:bg-green-200 transition-colors",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Sebelumnya"]}),e.jsxs("button",{onClick:ge,disabled:i>=T,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-green-100 text-green-700 font-medium disabled:opacity-50 hover:bg-green-200 transition-colors",children:["Selanjutnya",e.jsx(Qe,{className:"w-4 h-4"})]}),c&&t&&e.jsxs("button",{onClick:()=>Y(t),disabled:x===t.id,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 ${b(t.id).is_bookmarked?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:b(t.id).is_bookmarked?"Hapus bookmark":"Tambah bookmark",children:[x===t.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-current"}):b(t.id).is_bookmarked?e.jsx(F,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"}),x===t.id?"Loading...":b(t.id).is_bookmarked?"Bookmarked":"Bookmark"]}),e.jsxs("button",{onClick:ye,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),"Share"]})]})]}):e.jsx("div",{className:"text-gray-500",children:"Pilih ayat untuk ditampilkan"})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border border-green-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Daftar Ayat"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:Array.from({length:T},(s,a)=>{const r=a+1,o=g[r],d=o&&c?b(o.id).is_bookmarked:!1;return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ue(r),className:`px-3 py-1 rounded-lg text-sm font-medium border ${i===r?"bg-green-600 text-white border-green-700":"bg-white text-green-700 border-green-200 hover:bg-green-50"}`,children:r}),d&&e.jsx(F,{className:"absolute -top-1 -right-1 w-3 h-3 text-yellow-500",title:"Ayat ini telah dibookmark"}),c&&o&&e.jsx("button",{onClick:k=>{k.stopPropagation(),Y(o)},disabled:x===o.id,className:`absolute -bottom-1 -right-1 p-1 rounded-full text-xs transition-colors disabled:opacity-50 ${d?"bg-yellow-500 text-white hover:bg-yellow-600":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,title:d?"Hapus bookmark":"Tambah bookmark",children:x===o.id?e.jsx("div",{className:"animate-spin rounded-full h-2 w-2 border-t border-b border-current"}):d?e.jsx(F,{className:"w-2 h-2"}):e.jsx(te,{className:"w-2 h-2"})})]},r)})}),c&&le&&e.jsxs("div",{className:"flex justify-center items-center mt-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Memuat status bookmark..."})]}),!c&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-700 text-center",children:[e.jsx("span",{className:"font-medium",children:"💡 Tips:"})," Login untuk menggunakan fitur bookmark dan menyimpan ayat favorit Anda!"]})})]})]}),ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",onClick:E,children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[80vh] overflow-y-auto shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-green-800",children:["Catatan Kaki #",de]}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx(ze,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"text-gray-700",children:me?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-500"}),e.jsx("span",{className:"ml-2",children:"Memuat catatan kaki..."})]}):e.jsx("div",{className:"prose prose-sm max-w-none",children:ce})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:E,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Tutup"})})]})})]})}export{Ke as default};
