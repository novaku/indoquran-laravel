import{u as ee,r as s,b as re,f as te,j as r}from"./index-C48tOfmy.js";const ie=({onSuggestionClick:S,onViewAllResults:k,surahs:_=[],className:O="",placeholder:Q="Cari ayat Al-Quran berdasarkan terjemahan Indonesia...",theme:K="islamic",value:E,onChange:c,disableAutocomplete:$=!1})=>{const g=ee(),[G,C]=s.useState(""),[m,d]=s.useState([]),[A,n]=s.useState(!1),[M,w]=s.useState(!1),[p,y]=s.useState(-1),N=s.useRef(null),L=s.useRef(null),j=s.useRef(null),u=s.useRef(null),D=s.useRef(""),v=E!==void 0,o=v?String(E||""):G,F=s.useCallback(async e=>{if(!e||e.length<2){d([]),w(!1);return}if(D.current===e)return;D.current=e,u.current&&u.current.abort();const t=new AbortController;u.current=t;const x=re.getAuthToken();w(!0);try{const h=_.filter(i=>i.name_latin.toLowerCase().includes(e.toLowerCase())||i.name_indonesian.toLowerCase().includes(e.toLowerCase())||i.number.toString()===e).slice(0,3).map(i=>({type:"surah",surah:i,text:i.name_latin,highlightedText:{before:"",match:i.name_latin,after:` (${i.name_indonesian})`}})),T=await te(`/api/cari?q=${encodeURIComponent(e)}&limit=5`,{signal:t.signal,headers:{Authorization:x?`Bearer ${x}`:"","Content-Type":"application/json",Accept:"application/json"}});if(!T.ok)throw new Error("Failed to fetch suggestions");const R=await T.json();if(R.status==="success"){const i=Array.isArray(R.data)?R.data:[];if(!Array.isArray(i)){d(h);return}const q=i.map((f,ae)=>{if(!f||typeof f!="object")return null;const l={...f,surah_number:f.surah_number||null,number:f.number||f.ayah_number||null,text_indonesian:f.text_indonesian||""};if(!l.surah_number||!l.number)return null;let U=l.text_indonesian;const W=l.text_indonesian.toLowerCase(),z=e.toLowerCase();if(W.includes(z)){const b=W.indexOf(z);U={before:l.text_indonesian.substring(0,b),match:l.text_indonesian.substring(b,b+e.length),after:l.text_indonesian.substring(b+e.length)}}return{type:"ayah",ayah:l,surahName:_.find(b=>b.number===l.surah_number)?.name_latin||`Surah ${l.surah_number}`,text:l.text_indonesian,highlightedText:U}}).filter(Boolean).slice(0,3);d([...h,...q])}}catch(h){h.name!=="AbortError"&&(console.error("Error fetching suggestions:",h),d([]))}finally{t.signal.aborted||w(!1),u.current===t&&(u.current=null)}},[_]),H=s.useCallback(e=>{j.current&&clearTimeout(j.current);const t=String(e||"");j.current=setTimeout(()=>{t&&t.length>=2?F(t):(d([]),n(!1),w(!1))},500)},[F]);s.useEffect(()=>($?(d([]),n(!1),w(!1)):H(o),()=>{j.current&&clearTimeout(j.current),u.current&&u.current.abort()}),[o,H,$]),s.useEffect(()=>{const e=t=>{N.current&&!N.current.contains(t.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[N]),s.useEffect(()=>{y(-1)},[m]),s.useEffect(()=>{if(p>=0&&L.current){const e=L.current.querySelector(`li:nth-child(${p+1})`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[p]);const P=e=>{e.preventDefault();const t=e.target.elements.search.value.trim();t&&(g(`/cari?q=${encodeURIComponent(t)}`),n(!1),k&&k(t))},J=e=>{if(!e||!e.target)return;const t=e.target.value||"";v?c&&typeof c=="function"&&c(t):C(t),t.length>=2?n(!0):n(!1)},V=()=>{!$&&o&&o.length>=2&&n(!0)},X=e=>{if(!(!A||m.length===0))if(e.key==="ArrowDown")e.preventDefault(),y(t=>t<m.length-1?t+1:0);else if(e.key==="ArrowUp")e.preventDefault(),y(t=>t>0?t-1:m.length-1);else if(e.key==="Enter"&&p>=0){e.preventDefault();const t=m[p];(t.type==="ayah"&&t.ayah||t.type==="surah"&&t.surah)&&B(t)}else e.key==="Escape"&&(n(!1),y(-1))},B=s.useCallback(e=>{if(e.type==="ayah"&&e.ayah){const x=e.ayah.surah_number,h=e.ayah.number||e.ayah.ayah_number;if(x&&h){const T=`/surah/${x}/${h}`;g(T)}}else if(e.type==="surah"&&e.surah){const x=`/surah/${e.surah.number}`;g(x)}n(!1);const t=e.text||"";v?c&&c(t):C(t),S&&S(e)},[g,S,v,c]),Y=()=>{g(`/cari?q=${encodeURIComponent(o)}`),n(!1),k&&k(o)},Z=()=>{v?c&&c(""):C(""),d([]),n(!1),y(-1)},I={islamic:{primary:"islamic-green",primaryBorder:"islamic-green/20",primaryFocus:"islamic-green/30",primaryHover:"islamic-green/40",primaryText:"islamic-green",primaryBg:"islamic-green/5",primaryAccent:"islamic-green/10"},amber:{primary:"amber-500",primaryBorder:"amber-200",primaryFocus:"amber-300",primaryHover:"amber-300",primaryText:"amber-600",primaryBg:"amber-50",primaryAccent:"amber-100"}},a=I[K]||I.islamic;return r.jsx("div",{className:`relative w-full ${O}`,children:r.jsx("form",{onSubmit:P,method:"GET",className:"flex items-center",children:r.jsxs("div",{className:"relative w-full",ref:N,children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-${a.primaryText}`,viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),r.jsx("input",{type:"text",name:"search",value:o,onChange:J,onFocus:V,onKeyDown:X,placeholder:Q,className:`w-full pl-12 pr-12 py-4 rounded-xl border-2 border-${a.primaryBorder} focus:outline-none focus:ring-2 focus:ring-${a.primaryFocus} focus:border-${a.primaryHover} shadow-md text-base bg-white/80 backdrop-blur-sm hover:shadow-lg transition-shadow`}),o&&r.jsx("button",{type:"button",onClick:Z,className:`absolute right-4 top-1/2 -translate-y-1/2 text-${a.primaryText}/60 hover:text-${a.primaryText} transition-colors`,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!$&&A&&o.length>=2&&r.jsxs("div",{className:`absolute mt-2 w-full bg-white rounded-xl shadow-lg max-h-96 overflow-y-auto border border-${a.primaryBorder} z-50`,ref:L,children:[M?r.jsxs("div",{className:`p-4 text-center text-${a.primaryText}`,children:[r.jsx("div",{className:`inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-${a.primaryText} mr-2`}),"Mencari..."]}):m.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`px-4 py-2 border-b border-${a.primaryBorder} bg-${a.primaryBg}`,children:r.jsxs("h3",{className:`text-xs font-medium text-${a.primaryText}`,children:['Hasil Pencarian untuk "',o,'"']})}),r.jsx("ul",{className:"py-2",children:m.map((e,t)=>r.jsx("li",{onClick:()=>B(e),className:`px-4 py-3 hover:bg-${a.primaryBg} cursor-pointer border-b border-gray-100 last:border-b-0 ${p===t?`bg-${a.primaryBg}`:""} transition-colors duration-150`,onMouseEnter:()=>y(t),children:e.type==="surah"?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${a.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),r.jsx("span",{className:"font-medium",children:e.surah.name_latin}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsx("span",{children:e.surah.name_indonesian}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsxs("span",{children:[e.surah.total_ayahs," ayat"]}),r.jsx("span",{className:`ml-auto text-xs text-${a.primaryText} bg-${a.primaryAccent} px-2 py-0.5 rounded-full`,children:"Baca Surah →"})]}),r.jsxs("p",{className:"text-gray-600 text-sm",children:[e.surah.revelation_place," • Surah ke-",e.surah.number]})]}):e.ayah?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${a.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-1l-4 4z"})}),r.jsx("span",{className:"font-medium",children:e.surahName}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsxs("span",{children:["Ayat ",e.ayah.number||e.ayah.ayah_number]}),r.jsx("span",{className:`ml-auto text-xs text-${a.primaryText} bg-${a.primaryAccent} px-2 py-0.5 rounded-full`,children:"Lihat ayat →"})]}),r.jsxs("p",{className:"text-gray-700 text-sm overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[r.jsx("span",{className:`text-${a.primaryText} font-medium`,children:"Terjemahan: "}),typeof e.highlightedText=="object"?r.jsxs("span",{children:['"',e.highlightedText.before,r.jsx("span",{className:"bg-yellow-100 font-medium px-0.5 rounded-sm",children:e.highlightedText.match}),e.highlightedText.after,'"']}):`"${e.text}"`]})]}):r.jsx("div",{className:"p-2 text-sm text-gray-500",children:"Data tidak lengkap"})},`${e.type}-${t}`))})]}):r.jsxs("div",{className:"p-6 text-center",children:[r.jsx("div",{className:`text-${a.primaryText}/70 mb-3 font-medium`,children:"Tidak ada hasil yang cocok"}),r.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:'Coba gunakan kata kunci lain atau cari berdasarkan isi ayat. Contoh: "rahmat", "kasih sayang", "rezeki"'})]}),!M&&m.length>0&&r.jsx("div",{className:`p-4 border-t border-${a.primaryBorder}`,children:r.jsxs("button",{onClick:Y,className:`w-full py-3 px-4 bg-${a.primaryAccent} hover:bg-${a.primaryBg} text-${a.primaryText} font-medium rounded-xl transition-all duration-300 flex items-center justify-center shadow-sm hover:shadow`,type:"button",children:[r.jsx("span",{children:"Lihat Semua Hasil"}),r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})]})})})};export{ie as S};
