import{u as K,r as s,j as r,f as Q}from"./index-D_9Gsjlh.js";import{a as P}from"./auth-CHpCKrUu.js";const Y=({onSuggestionClick:w,onViewAllResults:y,surahs:j=[],className:E="",placeholder:M="Cari ayat Al-Quran berdasarkan terjemahan Indonesia...",theme:R="islamic"})=>{const p=K(),[n,v]=s.useState(""),[c,f]=s.useState([]),[T,o]=s.useState(!1),[C,_]=s.useState(!1),[d,u]=s.useState(-1),b=s.useRef(null),k=s.useRef(null),D=async e=>{if(!e||e.length<2){f([]);return}const a=P.getAuthToken();_(!0);try{const m=j.filter(i=>i.name_latin.toLowerCase().includes(e.toLowerCase())||i.name_indonesian.toLowerCase().includes(e.toLowerCase())||i.number.toString()===e).slice(0,3).map(i=>({type:"surah",surah:i,text:i.name_latin,highlightedText:{before:"",match:i.name_latin,after:` (${i.name_indonesian})`}})),g=await Q(`/api/search?q=${encodeURIComponent(e)}&limit=5`,{headers:{Authorization:a?`Bearer ${a}`:"","Content-Type":"application/json",Accept:"application/json"}});if(!g.ok)throw new Error("Failed to fetch suggestions");const N=await g.json();if(N.status==="success"){const i=Array.isArray(N.data)?N.data:[];if(!Array.isArray(i)){f(m);return}const O=i.map((h,G)=>{if(!h||typeof h!="object")return null;const l={...h,surah_number:h.surah_number||null,number:h.number||h.ayah_number||null,text_indonesian:h.text_indonesian||""};if(!l.surah_number||!l.number)return null;let L=l.text_indonesian;const B=l.text_indonesian.toLowerCase(),A=e.toLowerCase();if(B.includes(A)){const x=B.indexOf(A);L={before:l.text_indonesian.substring(0,x),match:l.text_indonesian.substring(x,x+e.length),after:l.text_indonesian.substring(x+e.length)}}return{type:"ayah",ayah:l,surahName:j.find(x=>x.number===l.surah_number)?.name_latin||`Surah ${l.surah_number}`,text:l.text_indonesian,highlightedText:L}}).filter(Boolean).slice(0,3);f([...m,...O])}}catch(m){console.error("Error fetching suggestions:",m)}finally{_(!1)}};s.useEffect(()=>{const e=setTimeout(()=>{n?D(n):f([])},300);return()=>clearTimeout(e)},[n,j]),s.useEffect(()=>{const e=a=>{b.current&&!b.current.contains(a.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b]),s.useEffect(()=>{u(-1)},[c]),s.useEffect(()=>{if(d>=0&&k.current){const e=k.current.querySelector(`li:nth-child(${d+1})`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[d]);const F=e=>{e.preventDefault();const a=e.target.elements.search.value.trim();a&&(p(`/search?q=${encodeURIComponent(a)}`),o(!1),y&&y(a))},H=e=>{const a=e.target.value;v(a),a.length>=2?o(!0):o(!1)},I=()=>{n&&n.length>=2&&o(!0)},U=e=>{if(!(!T||c.length===0))if(e.key==="ArrowDown")e.preventDefault(),u(a=>a<c.length-1?a+1:0);else if(e.key==="ArrowUp")e.preventDefault(),u(a=>a>0?a-1:c.length-1);else if(e.key==="Enter"&&d>=0){e.preventDefault();const a=c[d];(a.type==="ayah"&&a.ayah||a.type==="surah"&&a.surah)&&$(a)}else e.key==="Escape"&&(o(!1),u(-1))},$=s.useCallback(e=>{if(e.type==="ayah"&&e.ayah){const a=e.ayah.surah_number,m=e.ayah.number||e.ayah.ayah_number;if(a&&m){const g=`/surah/${a}/${m}`;p(g)}}else if(e.type==="surah"&&e.surah){const a=`/surah/${e.surah.number}`;p(a)}o(!1),v(""),w&&w(e)},[p,w]),W=()=>{p(`/search?q=${encodeURIComponent(n)}`),o(!1),y&&y(n)},z=()=>{v(""),f([]),o(!1),u(-1)},S={islamic:{primary:"islamic-green",primaryBorder:"islamic-green/20",primaryFocus:"islamic-green/30",primaryHover:"islamic-green/40",primaryText:"islamic-green",primaryBg:"islamic-green/5",primaryAccent:"islamic-green/10"},amber:{primary:"amber-500",primaryBorder:"amber-200",primaryFocus:"amber-300",primaryHover:"amber-300",primaryText:"amber-600",primaryBg:"amber-50",primaryAccent:"amber-100"}},t=S[R]||S.islamic;return r.jsx("div",{className:`relative w-full ${E}`,children:r.jsx("form",{onSubmit:F,enctype:"application/x-www-form-urlencoded",className:"flex items-center",children:r.jsxs("div",{className:"relative w-full",ref:b,children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 absolute left-4 top-1/2 -translate-y-1/2 text-${t.primaryText}`,viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),r.jsx("input",{type:"text",name:"search",value:n,onChange:H,onFocus:I,onKeyDown:U,placeholder:M,className:`w-full pl-12 pr-12 py-4 rounded-xl border-2 border-${t.primaryBorder} focus:outline-none focus:ring-2 focus:ring-${t.primaryFocus} focus:border-${t.primaryHover} shadow-md text-base bg-white/80 backdrop-blur-sm hover:shadow-lg transition-shadow`}),n&&r.jsx("button",{type:"button",onClick:z,className:`absolute right-4 top-1/2 -translate-y-1/2 text-${t.primaryText}/60 hover:text-${t.primaryText} transition-colors`,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),T&&n.length>=2&&r.jsxs("div",{className:`absolute mt-2 w-full bg-white rounded-xl shadow-lg max-h-96 overflow-y-auto border border-${t.primaryBorder} z-50`,ref:k,children:[C?r.jsxs("div",{className:`p-4 text-center text-${t.primaryText}`,children:[r.jsx("div",{className:`inline-block animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-${t.primaryText} mr-2`}),"Mencari..."]}):c.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`px-4 py-2 border-b border-${t.primaryBorder} bg-${t.primaryBg}`,children:r.jsxs("h3",{className:`text-xs font-medium text-${t.primaryText}`,children:['Hasil Pencarian untuk "',n,'"']})}),r.jsx("ul",{className:"py-2",children:c.map((e,a)=>r.jsx("li",{onClick:()=>$(e),className:`px-4 py-3 hover:bg-${t.primaryBg} cursor-pointer border-b border-gray-100 last:border-b-0 ${d===a?`bg-${t.primaryBg}`:""} transition-colors duration-150`,onMouseEnter:()=>u(a),children:e.type==="surah"?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${t.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),r.jsx("span",{className:"font-medium",children:e.surah.name_latin}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsx("span",{children:e.surah.name_indonesian}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsxs("span",{children:[e.surah.total_ayahs," ayat"]}),r.jsx("span",{className:`ml-auto text-xs text-${t.primaryText} bg-${t.primaryAccent} px-2 py-0.5 rounded-full`,children:"Baca Surah →"})]}),r.jsxs("p",{className:"text-gray-600 text-sm",children:[e.surah.revelation_place," • Surah ke-",e.surah.number]})]}):e.ayah?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center text-gray-800 text-sm mb-1.5",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 mr-2 text-${t.primaryText}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-1l-4 4z"})}),r.jsx("span",{className:"font-medium",children:e.surahName}),r.jsx("span",{className:"mx-1.5",children:"•"}),r.jsxs("span",{children:["Ayat ",e.ayah.number||e.ayah.ayah_number]}),r.jsx("span",{className:`ml-auto text-xs text-${t.primaryText} bg-${t.primaryAccent} px-2 py-0.5 rounded-full`,children:"Lihat ayat →"})]}),r.jsxs("p",{className:"text-gray-700 text-sm overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:[r.jsx("span",{className:`text-${t.primaryText} font-medium`,children:"Terjemahan: "}),typeof e.highlightedText=="object"?r.jsxs("span",{children:['"',e.highlightedText.before,r.jsx("span",{className:"bg-yellow-100 font-medium px-0.5 rounded-sm",children:e.highlightedText.match}),e.highlightedText.after,'"']}):`"${e.text}"`]})]}):r.jsx("div",{className:"p-2 text-sm text-gray-500",children:"Data tidak lengkap"})},`${e.type}-${a}`))})]}):r.jsxs("div",{className:"p-6 text-center",children:[r.jsx("div",{className:`text-${t.primaryText}/70 mb-3 font-medium`,children:"Tidak ada hasil yang cocok"}),r.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:'Coba gunakan kata kunci lain atau cari berdasarkan isi ayat. Contoh: "rahmat", "kasih sayang", "rezeki"'})]}),!C&&c.length>0&&r.jsx("div",{className:`p-4 border-t border-${t.primaryBorder}`,children:r.jsxs("button",{onClick:W,className:`w-full py-3 px-4 bg-${t.primaryAccent} hover:bg-${t.primaryBg} text-${t.primaryText} font-medium rounded-xl transition-all duration-300 flex items-center justify-center shadow-sm hover:shadow`,type:"button",children:[r.jsx("span",{children:"Lihat Semua Hasil"}),r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})]})})})};export{Y as S};
